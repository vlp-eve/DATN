<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Edit Product</title>
</head>
<body>
<h2>Edit Product</h2>
<form id="edit-product-form">
  <input type="hidden" id="productId" name="productId" />
  <label for="name">Name:</label>
  <input type="text" id="name" name="name" required /><br>

  <label for="description">Description:</label>
  <textarea id="description" name="description" required></textarea><br>

  <label for="price">Price:</label>
  <input type="number" id="price" name="price" required /><br>

  <label for="expiryDate">Expiry Date:</label>
  <input type="date" id="expiryDate" name="expiryDate" required /><br>

  <label for="imgBannerPath">Image Path:</label>
  <input type="text" id="imgBannerPath" name="imgBannerPath" /><br>

  <button type="submit">Save Changes</button>
  <button type="button" onclick="cancelEdit()">Cancel</button>
</form>

<script>
    // Lấy productId từ URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('productId');

    // Gọi API để lấy thông tin sản phẩm
    fetch(`http://localhost:8080/api/products/${productId}`)
        .then(response => response.json())
        .then(product => {
            // Điền thông tin sản phẩm vào form
            document.getElementById('productId').value = product.productId;
            document.getElementById('name').value = product.name;
            document.getElementById('description').value = product.description;
            document.getElementById('price').value = product.price;
            document.getElementById('expiryDate').value = product.expiryDate;
            document.getElementById('imgBannerPath').value = product.imgBannerPath;
        })
        .catch(error => console.error('Error fetching product:', error));

    // Xử lý khi gửi form
    document.getElementById('edit-product-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Ngăn không cho trang reload

        const updatedProduct = {
            productId: document.getElementById('productId').value,
            name: document.getElementById('name').value,
            description: document.getElementById('description').value,
            price: document.getElementById('price').value,
            expiryDate: document.getElementById('expiryDate').value,
            imgBannerPath: document.getElementById('imgBannerPath').value
        };

        // Gửi yêu cầu PUT để cập nhật sản phẩm
        fetch(`http://localhost:8080/api/products/update`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedProduct)
        })
        .then(response => {
            if (response.ok) {
                alert('Product updated successfully!');
                window.location.href = '/product-list'; // Quay lại danh sách sản phẩm
            } else {
                alert('Error updating product.');
            }
        })
        .catch(error => console.error('Error updating product:', error));
    });

    function cancelEdit() {
        window.location.href = '/product-list'; // Quay lại danh sách sản phẩm
    }
</script>
</body>
</html>
