<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh Sách Sản Phẩm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        #product-list {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        .product-item {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            width: 300px;
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: #fff;
        }
        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        h2 {
            margin: 0;
            color: #007bff;
        }
        .modal {
            display: none; /* Ẩn hộp thoại mặc định */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); /* Màu nền mờ */
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #888;
            width: 80%;
            animation: slideIn 0.5s; /* Hiệu ứng mở hộp thoại */
        }
        @keyframes slideIn {
            from {
                top: -300px;
                opacity: 0;
            }
            to {
                top: 0;
                opacity: 1;
            }
        }
        .close {
            color: red;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>Danh Sách Sản Phẩm</h1>
<button id="addProductBtn">Thêm Sản Phẩm</button>
<div id="product-list"></div>
<div id="loading" style="display: none; text-align: center;">Đang tải thêm sản phẩm...</div>

<!-- Hộp thoại Thêm sản phẩm -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <span id="closeAddModal" class="close">&times;</span>
        <h2>Thêm Sản Phẩm Mới</h2>
        <label for="addName">Tên:</label>
        <input type="text" id="addName" required><br>
        <label for="addDescription">Mô tả:</label>
        <input type="text" id="addDescription" required><br>
        <label for="addPrice">Giá:</label>
        <input type="number" id="addPrice" required><br>
        <label for="addStockQuantity">Số lượng tồn kho:</label>
        <input type="number" id="addStockQuantity" required><br>
        <label for="addCreateDate">Ngày tạo:</label>
        <input type="date" id="addCreateDate" required><br>
        <label for="addExpiryDate">Ngày hết hạn:</label>
        <input type="date" id="addExpiryDate" required><br>
        <button id="saveAddBtn">Thêm</button>
    </div>
</div>

<!-- Hộp thoại Cập nhật -->
<div id="updateModal" class="modal">
    <div class="modal-content">
        <span id="closeUpdateModal" class="close">&times;</span>
        <h2>Cập nhật Sản Phẩm</h2>
        <input type="hidden" id="updateProductId">
        <label for="updateName">Tên:</label>
        <input type="text" id="updateName" required><br>
        <label for="updateDescription">Mô tả:</label>
        <input type="text" id="updateDescription" required><br>
        <label for="updatePrice">Giá:</label>
        <input type="number" id="updatePrice" required><br>
        <label for="updateStockQuantity">Số lượng tồn kho:</label>
        <input type="number" id="updateStockQuantity" required><br>
        <label for="updateCreateDate">Ngày tạo:</label>
        <input type="date" id="updateCreateDate" required><br>
        <label for="updateExpiryDate">Ngày hết hạn:</label>
        <input type="date" id="updateExpiryDate" required><br>
        <button id="saveUpdateBtn">Lưu</button>
    </div>
</div>

<script>
    let currentPage = 0; // Biến để theo dõi trang hiện tại
    const pageSize = 5; // Số sản phẩm tải mỗi lần
    const productList = document.getElementById('product-list');

    // Hàm để tải danh sách sản phẩm
    function loadProducts() {
        document.getElementById('loading').style.display = "block"; // Hiện thông báo tải
        fetch(`http://localhost:8080/api/products1/non-deleted?page=${currentPage}&size=${pageSize}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('loading').style.display = "none"; // Ẩn thông báo tải

                // Lọc bỏ sản phẩm có status là 0 (sản phẩm hỏng)
                const filteredProducts = data.filter(product => product.status !== 0);

                // Hiển thị sản phẩm không hỏng
                filteredProducts.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'product-item';
                    productItem.innerHTML = `
                        <h2>${product.name}</h2>
                        <p><strong>Mô tả:</strong> ${product.description}</p>
                        <p><strong>Giá:</strong> ${product.price} VNĐ</p>
                        <p><strong>Ngày tạo:</strong> ${product.createDate}</p>
                        <p><strong>Ngày hết hạn:</strong> ${product.expiryDate}</p>
                        <p><strong>Trạng thái:</strong> ${product.status === 1 ? 'Tươi' : 'Hỏng'}</p>
                        <p><strong>Số lượng tồn kho:</strong> ${product.stockQuantity}</p>
                        <button onclick="openUpdateModal(${product.productId}, '${product.name}', '${product.description}', ${product.price}, ${product.stockQuantity}, '${product.createDate}', '${product.expiryDate}')">Cập nhật</button>
                        <button onclick="deleteProduct(${product.productId})">Xóa</button>
                    `;
                    productList.appendChild(productItem);
                });
            })
            .catch(error => {
                console.error('Lỗi:', error);
            });
    }

    // Tải sản phẩm lần đầu
    window.onload = loadProducts;

    // Hàm để kiểm tra khi cuộn trang
    window.onscroll = function() {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {
            currentPage++; // Tăng trang hiện tại
            loadProducts(); // Tải sản phẩm mới
        }
    };

    // Mở hộp thoại Thêm sản phẩm
    document.getElementById('addProductBtn').onclick = function() {
        document.getElementById('addModal').style.display = "block";
    };

    document.getElementById('closeAddModal').onclick = function() {
        document.getElementById('addModal').style.display = "none"; // Đóng hộp thoại
    };

    document.getElementById('saveAddBtn').onclick = function() {
        const newProduct = {
            name: document.getElementById('addName').value,
            description: document.getElementById('addDescription').value,
            price: document.getElementById('addPrice').value,
            stockQuantity: document.getElementById('addStockQuantity').value,
            createDate: document.getElementById('addCreateDate').value,
            expiryDate: document.getElementById('addExpiryDate').value,
            status: 1, // Mặc định là "tươi"
            isDeleted: false // Mặc định chưa bị xóa
        };

        // Gọi API thêm sản phẩm
        fetch('http://localhost:8080/api/products1', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newProduct),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            alert('Thêm sản phẩm thành công!');
            document.getElementById('addModal').style.display = "none"; // Đóng hộp thoại
            productList.innerHTML = ''; // Xóa danh sách cũ
            currentPage = 0; // Reset trang về 0
            loadProducts(); // Tải lại danh sách sản phẩm
        })
        .catch(error => {
            console.error('Lỗi:', error);
        });
    };

    // Các hàm xử lý khác (cập nhật, xóa sản phẩm)
</script>
</body>
</html>
