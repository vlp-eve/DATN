<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý người dùng</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: #45a049;
}

    </style>
</head>
<body>
<h1>Quản lý người dùng</h1>

<!-- Hiển thị danh sách người dùng -->
<section>
    <h2>Danh sách người dùng</h2>
    <table id="userTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Tên đầy đủ</th>
            <th>Email</th>
            <th>Địa chỉ</th>
            <th>Số điện thoại</th>
            <th>Giới tính</th>
            <th>Username</th>
            <th>Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <!-- Danh sách người dùng sẽ được thêm ở đây -->
        </tbody>
    </table>
</section>

<!-- Thêm người dùng mới -->
<section>
    <h2>Thêm người dùng mới</h2>
    <form id="addUserForm">
        <label for="fullName">Tên đầy đủ:</label>
        <input type="text" id="fullName" name="fullName" required><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br>

        <label for="address">Địa chỉ:</label>
        <input type="text" id="address" name="address" required><br>

        <label for="phone">Số điện thoại:</label>
        <input type="text" id="phone" name="phone" required><br>

        <label for="gender">Giới tính:</label>
        <input type="text" id="gender" name="gender" required><br>

        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>

        <button type="submit">Thêm người dùng</button>
    </form>
</section>

<!-- Cập nhật người dùng -->
<section id="updateSection" style="display: none;">
    <h2>Cập nhật người dùng</h2>
    <form id="updateUserForm">
        <input type="hidden" id="updateUserId">

        <label for="updateFullName">Tên đầy đủ:</label>
        <input type="text" id="updateFullName" required><br>

        <label for="updateEmail">Email:</label>
        <input type="email" id="updateEmail" required><br>

        <label for="updateAddress">Địa chỉ:</label>
        <input type="text" id="updateAddress" required><br>

        <label for="updatePhone">Số điện thoại:</label>
        <input type="text" id="updatePhone" required><br>

        <label for="updateGender">Giới tính:</label>
        <input type="text" id="updateGender" required><br>

        <label for="updateUsername">Username:</label>
        <input type="text" id="updateUsername" required><br>

        <label for="updatePassword">Password:</label>
        <input type="password" id="updatePassword" required><br>

        <button type="submit">Cập nhật người dùng</button>
    </form>
</section>

<!-- Xử lý bằng JavaScript -->
<script>
        // Lấy danh sách người dùng từ API và hiển thị trong bảng
        function fetchUsers() {
            fetch('http://localhost:8080/api/users')
                .then(response => response.json())
                .then(data => {
                    const userTableBody = document.querySelector('#userTable tbody');
                    userTableBody.innerHTML = ''; // Xóa nội dung cũ
                    data.forEach(user => {
                        const row = `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.fullName}</td>
                                <td>${user.email}</td>
                                <td>${user.address}</td>
                                <td>${user.phone}</td>
                                <td>${user.gender}</td>
                                <td>${user.username}</td>
                                <td>
                                    <button onclick="editUser(${user.id})">Sửa</button>
                                    <button onclick="deleteUser(${user.id})">Xóa</button>
                                </td>
                            </tr>`;
                        userTableBody.innerHTML += row;
                    });
                });
        }

        // Thêm người dùng mới
        document.getElementById('addUserForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const user = {
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                address: formData.get('address'),
                phone: formData.get('phone'),
                gender: formData.get('gender'),
                username: formData.get('username'),
                password: formData.get('password'),
            };
            fetch('http://localhost:8080/api/users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(user)
            })
            .then(() => {
                fetchUsers(); // Cập nhật danh sách
                event.target.reset(); // Reset form
            });
        });

        // Xóa người dùng
        function deleteUser(id) {
            fetch(`http://localhost:8080/api/users/${id}`, { method: 'DELETE' })
                .then(() => fetchUsers());
        }

        // Sửa người dùng
        function editUser(id) {
            fetch(`http://localhost:8080/api/users/${id}`)
                .then(response => response.json())
                .then(user => {
                    document.getElementById('updateUserId').value = user.id;
                    document.getElementById('updateFullName').value = user.fullName;
                    document.getElementById('updateEmail').value = user.email;
                    document.getElementById('updateAddress').value = user.address;
                    document.getElementById('updatePhone').value = user.phone;
                    document.getElementById('updateGender').value = user.gender;
                    document.getElementById('updateUsername').value = user.username;
                    document.getElementById('updatePassword').value = user.password;
                    document.getElementById('updateSection').style.display = 'block';
                });
        }

        // Cập nhật người dùng
        document.getElementById('updateUserForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('updateUserId').value;
            const user = {
                fullName: document.getElementById('updateFullName').value,
                email: document.getElementById('updateEmail').value,
                address: document.getElementById('updateAddress').value,
                phone: document.getElementById('updatePhone').value,
                gender: document.getElementById('updateGender').value,
                username: document.getElementById('updateUsername').value,
                password: document.getElementById('updatePassword').value,
            };
            fetch(`http://localhost:8080/api/users/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(user)
            })
            .then(() => {
                fetchUsers(); // Cập nhật danh sách
                document.getElementById('updateSection').style.display = 'none'; // Ẩn form cập nhật
            });
        });

        // Gọi hàm fetchUsers để hiển thị danh sách người dùng ban đầu
        fetchUsers();
    </script>
</body>
</html>
