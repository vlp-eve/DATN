<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thêm sản phẩm</title>
</head>
<body>
<h1>Thêm sản phẩm mới</h1>
<form id="addProductForm" enctype="multipart/form-data">
  <label for="name">Tên sản phẩm:</label>
  <input type="text" id="name" name="name" required><br>

  <label for="description">Mô tả sản phẩm:</label>
  <textarea id="description" name="description" required></textarea><br>

  <label for="price">Giá sản phẩm:</label>
  <input type="number" id="price" name="price" required><br>

  <label for="imgBanner">ảnh banner:</label>
  <input type="file" id="imgBanner" name="imgBanner" multiple required>

  <label for="stockQuantity">Số lượng tồn kho:</label>
  <input type="number" id="stockQuantity" name="stockQuantity" required><br>

  <label for="expiryDate">Ngày hết hạn:</label>
  <input type="date" id="expiryDate" name="expiryDate" required><br>

  <label for="categoryId">Danh mục:</label>
  <select id="categoryId" name="categoryId" required>
    <!-- Danh sách danh mục sẽ được thêm ở đây -->
  </select><br>

  <label for="unitId">Đơn vị:</label>
  <select id="unitId" name="unitId" required>
    <!-- Danh sách đơn vị sẽ được thêm ở đây -->
  </select><br>

  <label for="images">Tải lên ảnh sản phẩm:</label>
  <input type="file" id="images" name="images" accept="image/*" multiple required><br>

  <button type="submit">Thêm sản phẩm</button>
</form>

<script>
        // Hàm để lấy danh sách danh mục từ API
        async function loadCategories() {
            const response = await fetch('http://localhost:8080/api/categories'); // Đường dẫn API để lấy danh mục
            if (response.ok) {
                const categories = await response.json();
                const categorySelect = document.getElementById('category_id');
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id; // Giả định thuộc tính id của danh mục
                    option.textContent = category.name; // Giả định thuộc tính name của danh mục
                    categorySelect.appendChild(option);
                });
            } else {
                console.error('Không thể lấy danh mục');
            }
        }

        // Hàm để lấy danh sách đơn vị từ API
        async function loadUnits() {
            const response = await fetch('http://localhost:8080/api/units'); // Đường dẫn API để lấy đơn vị
            if (response.ok) {
                const units = await response.json();
                const unitSelect = document.getElementById('unit_id');
                units.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit.id; // Giả định thuộc tính id của đơn vị
                    option.textContent = unit.name; // Giả định thuộc tính name của đơn vị
                    unitSelect.appendChild(option);
                });
            } else {
                console.error('Không thể lấy đơn vị');
            }
        }

        // Gọi các hàm loadCategories và loadUnits khi trang được tải
        window.onload = function() {
            loadCategories();
            loadUnits();
        };

        document.getElementById('addProductForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Ngăn chặn hành động mặc định của form

            const formData = new FormData(this);

            fetch('http://localhost:8080/api/products1', {
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Có lỗi xảy ra khi thêm sản phẩm');
                }
                return response.json();
            })
            .then(data => {
                alert('Sản phẩm đã được thêm thành công!');
                this.reset(); // Reset form sau khi thêm sản phẩm thành công
            })
            .catch(error => {
                alert(error.message);
            });
        });
    </script>
</body>
</html>
